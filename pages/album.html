<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
        <link rel="stylesheet" type="text/css" href="../style.css">
        <link rel="stylesheet" href="../mdl/material.min.css">
        <script src="../mdl/material.min.js" id="mdl-script"></script>
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <link rel="stylesheet" href="../css/dialog-polyfill.css">
    </head>
    <body onload="setPosition()">
        <content>
            <div class="mdl-tabs__panel">
                <!-- <div class="mdl-grid">
                    <div class="mdl-layout-spacer"></div>
                    <a id="categoria-perfil">
                        <span class="pontos">.</span><span>Perfil</span>
                    </a>
                    <div class="mdl-layout-spacer"></div>
                </div> -->
            <div id="perfil-div" class="mdl-grid">
                <div class="mdl-layout-spacer"></div>
                <div id="album-box" class="mdl-cell mdl-cell--3-col">

                    <div class="mdl-grid">
                        <div id="cla-infos" class="mdl-cell mdl-cell--3-col">

                            <div id="img_infos">
                                <a href="#">
                                    <div id="imgperfil"></div>
                                    <div id="badgeperfil">
                                        <i class="material-icons">photo_camera</i>
                                    </div>
                                </a>

                                <div id="perfilinfos">
                                    <p class="titulo">
                                        <span id="perfilnome">Billy</span>,
                                        <span id="perfilidade">12</span>
                                        <span><a href="#"><i class="material-icons">border_color</i></a></span>
                                    </p>
                                    <p id="perfilbio">Olá, sou um West Highland White Terrier fofinho, amante da natureza e doador desde os 5 anos.</p>
                                    <p id="perfiltiposanguineo">A+</p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="mdl-layout-spacer"></div>
                </div>
            </div>

            <div class="mdl-tabs mdl-js-tabs">
                <div id="categorias-albumatual-bottom" class="mdl-grid">
                    <div class="mdl-layout-spacer"></div>
                    <div id="categorias-albumatual" class="mdl-tabs__tab-bar">
                        <a href="#albuns" class="mdl-tabs__tab is-active tab-title">
                            <p id="categoria-album">
                            <span class="pontos">.</span><span>Álbum</span>
                            </p>
                        </a>
                        <a href="#inventorio" class="mdl-tabs__tab tab-title">
                            <p id="categoria-album">
                            <span class="pontos">.</span><span>Arquivo</span> <span class="quantidades">(2)</span>
                            </p>
                        </a>
                    </div>
                    <div class="mdl-layout-spacer"></div>
                </div>

                <div class="mdl-tabs__panel is-active" id="albuns"> <!-- Primeira Aba -->

                    <div class="mdl-grid">
                    <div class="mdl-layout-spacer"></div>
                        <p id="album-title"><span id="album-title-space">⠀<span id="album-title-txt">Álbum Inicial: Pedro Sincero</span>⠀</span></p>
                    <div class="mdl-layout-spacer"></div>
                    </div>

                    <div id="figuras-grade" class="mdl-grid">
                        <div class="mdl-layout-spacer"></div>
                        <div class="mdl-card mdl-cell mdl-cell--4-col"> <!-- inicio da estrutura do álbum-->
                            <div class="mdl-grid"> <!--Primeira linha do álbum> -->
                                <div class="mdl-cell mdl-cell--1-col album-space card-spot"></div>
                                <div class="mdl-cell mdl-cell--1-col album-space card-spot"></div>
                                <div class="mdl-cell mdl-cell--1-col album-space card-spot"><img id="img01" style="height: 42px;" class="dont-move" src="../img/gotaverde.png" data-cardtype="9"/></div>
                                <div class="mdl-cell mdl-cell--1-col album-space card-spot"></div>
                            </div>
                            <div class="mdl-grid"> <!--Segunda linha do álbum> -->
                                <div class="mdl-cell mdl-cell--1-col album-space card-spot"></div>
                                <div class="mdl-cell mdl-cell--1-col album-space card-spot"></div>
                                <div class="mdl-cell mdl-cell--1-col album-space card-spot"></div>
                                <div class="mdl-cell mdl-cell--1-col album-space card-spot"></div>
                            </div>
                            <div class="mdl-grid"> <!--Terceira linha do álbum> -->
                                <div class="mdl-cell mdl-cell--1-col album-space card-spot"><img id="img03" style="height: 42px;" class="dont-move" src="../img/gotalaranja.png" data-cardtype="5"/></div>
                                <div class="mdl-cell mdl-cell--1-col album-space card-spot"></div>
                                <div class="mdl-cell mdl-cell--1-col album-space card-spot"></div>
                                <div class="mdl-cell mdl-cell--1-col album-space card-spot"></div>
                            </div>
                            <div class="mdl-grid"> <!--Quarta linha do álbum> -->
                                <div class="mdl-cell mdl-cell--1-col album-space card-spot"></div>
                                <div class="mdl-cell mdl-cell--1-col album-space card-spot"></div>
                                <div class="mdl-cell mdl-cell--1-col album-space card-spot"></div>
                                <div class="mdl-cell mdl-cell--1-col album-space card-spot"><img id="img04" style="height: 42px;" class="dont-move" src="../img/gotaazul.png" data-cardtype="16"/></div>
                            </div>
                            <div class="mdl-grid">
                                <div class="mdl-cell mdl-cell--1-col infosalbum">
                                    <p id="contador-cartas" class="albuminfos">04/16 figurinhas</p>
                                    <p id="contador-comb" class="albuminfos">1 combinação</p>
                                </div>
                            </div>
                        </div>
                        <div class="mdl-layout-spacer"></div>
                    </div>
                    <div class="mdl-grid" >
                        <div class="mdl-layout-spacer"></div>
                            <p id="inventario-title">⇵⠀selecione um item abaixo e uma posição acima⠀⇵</p>
                        <div class="mdl-layout-spacer"></div>
                        </div>

                    <div class="mdl-grid" style="height: 153px;">
                        <div class="mdl-layout-spacer"></div>
                        <div class="mdl-card mdl-cell mdl-cell--4-col"> <!-- inicio da estrutura do Inventário-->
                            <div id="inventario-rolagem" class="mdl-grid"> <!--Primeira linha do Inventário> -->
                                <div id="album-figura" class="mdl-cell mdl-cell--1-col album-space card-spot"><img style="height: 42px;" src="../img/gotaverde.png" data-cardtype="9"></div>
                                <div id="album-figura" class="mdl-cell mdl-cell--1-col album-space card-spot"><img style="height: 42px;" src="../img/gota.png" data-cardtype="3"></div>
                                <div id="album-figura" class="mdl-cell mdl-cell--1-col album-space card-spot"><img style="height: 42px;" src="../img/gotalaranja.png" data-cardtype="5"></div>
                                <div id="album-figura" class="mdl-cell mdl-cell--1-col album-space card-spot"><img style="height: 42px;" src="../img/gotaazul.png" data-cardtype="16"></div>
                                <div id="album-figura" class="mdl-cell mdl-cell--1-col album-space card-spot"><img style="height: 42px;" src="../img/gotaverde.png" data-cardtype="9"></div>
                                <div id="album-figura" class="mdl-cell mdl-cell--1-col album-space card-spot"><img style="height: 42px;" src="../img/gota.png" data-cardtype="3"></div>
                                <div id="album-figura" class="mdl-cell mdl-cell--1-col album-space card-spot"><img style="height: 42px;" src="../img/gotalaranja.png" data-cardtype="5"></div>
                                <div id="album-figura" class="mdl-cell mdl-cell--1-col album-space card-spot"><img style="height: 42px;" src="../img/gotaazul.png" data-cardtype="16"></div>
                                <div id="album-figura" class="mdl-cell mdl-cell--1-col album-space card-spot"><img style="height: 42px;" src="../img/gotaazul.png" data-cardtype="16"></div>
                                <div style="min-width: 0.2px;"></div>
                            </div>

                            <div class="mdl-grid">
                                <div class="mdl-layout-spacer"></div>
                                <div id="inventariobotoes" class="mdl-cell mdl-cell--1-col">
                                    <div class="mdl-layout-spacer"></div>
                                    <button class="mdl-button" id="itemPositionButton" onclick="dragmeToogle()">
                                        Posicionar
                                    </button>
                                    <div class="mdl-layout-spacer"></div>
                                </div>
                                <div class="mdl-layout-spacer"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="inventorio" class="mdl-tabs__panel"> <!-- Segunda aba-->
                    <div class="mdl-grid">
                    <div class="mdl-layout-spacer"></div>
                        <p id="album-title"><span id="album-title-space">⠀<span id="album-title-txt">Álbum II: Memes Brasileiros</span>⠀</span></p>
                    <div class="mdl-layout-spacer"></div>
                    </div>

                    <div id="figuras-grade" class="mdl-grid">
                        <div class="mdl-layout-spacer"></div>
                        <div class="mdl-card mdl-cell mdl-cell--4-col"> <!-- inicio da estrutura do álbum 1o completo -->
                            <div class="mdl-grid"> <!--Primeira linha do álbum> -->
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                            </div>
                            <div class="mdl-grid"> <!--Segunda linha do álbum> -->
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                            </div>
                            <div class="mdl-grid"> <!--Terceira linha do álbum> -->
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                            </div>
                            <div class="mdl-grid"> <!--Quarta linha do álbum> -->
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                            </div>
                            <div class="mdl-grid">
                                <div class="mdl-cell mdl-cell--1-col infosalbum">
                                    <p class="albuminfos">16/16 figurinhas</p>
                                    <p class="albuminfos">10 combinações</p>
                                </div>
                            </div>
                        </div>
                        <div class="mdl-layout-spacer"></div>
                    </div>

                    <div class="mdl-grid">
                    <div class="mdl-layout-spacer"></div>
                        <p id="album-title"><span id="album-title-space">⠀<span id="album-title-txt">Álbum I: Literatura Brasileira</span>⠀</span></p>
                    <div class="mdl-layout-spacer"></div>
                    </div>

                    <div id="figuras-grade" class="mdl-grid">
                        <div class="mdl-layout-spacer"></div>
                        <div class="mdl-card mdl-cell mdl-cell--4-col"> <!-- inicio da estrutura do 2o álbum completo-->
                            <div class="mdl-grid"> <!--Primeira linha do álbum> -->
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                            </div>
                            <div class="mdl-grid"> <!--Segunda linha do álbum> -->
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                            </div>
                            <div class="mdl-grid"> <!--Terceira linha do álbum> -->
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                            </div>
                            <div class="mdl-grid"> <!--Quarta linha do álbum> -->
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                                <a href="#"><div class="mdl-cell mdl-cell--1-col album-space"><img style="height: 42px;" src="../img/gota.png"></div></a>
                            </div>
                            <div class="mdl-grid">
                                <div class="mdl-cell mdl-cell--1-col infosalbum">
                                    <p class="albuminfos">16/16 figurinhas</p>
                                    <p class="albuminfos">10 combinações</p>
                                </div>
                            </div>
                        </div>
                        <div class="mdl-layout-spacer"></div>
                    </div>

                </div>
            </div>
            <div id="bottom-space" class="mdl-grid"></div>
        </content>

        <!-- Caixa de díalogo que avisa sobre novo nível -->

        <dialog class="mdl-dialog" id="newLevelDialog">
            <button id="dialog-close" class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab close"> x </button>
            <h4 id="dialog-title" class="mdl-dialog__title">Nível 8<br>Concluído</h4>
            <img src="../img/levelUp_icon.png" width="200px" id="levelUpIcon">
            <p id="levelup-subtitle">Você salvou 12 vidas!</p>
            <button id="dialog-button" class="mdl-button">Continuar</button>
        </dialog>

        <!-- Caixa de diálogo que avisa sobre nova recompensa -->

        <dialog class="mdl-dialog" id="newItemDialog">
            <button id="dialog-close" class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab close"> x </button>
            <h4 id="dialog-title" class="mdl-dialog__title">Você ganhou<br>uma recompensa!</h4>
            <canvas id="levelUpCanvas">Seu browser não tem suporte para canvas</canvas>
            <button id="dialog-button" class="mdl-button">Abrir</button>
        </dialog>

        <script src="../js/dialog-polyfill.js"></script>
        <script src="../js/open_chest.js"></script>
        <script src="../app.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@shopify/draggable@1.0.0-beta.8/lib/draggable.bundle.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@shopify/draggable@1.0.0-beta.8/lib/swappable.js"></script>
        <script>

            function changeTabTitle(title) {
                document.getElementById("tab-title").innerText = title;
            }

           //Swappable das cartas 

           var container = document.querySelectorAll('.card-spot');
            const draggable = new Swappable.default(container, {
                draggable: '.drag-me',
                dropzone: '.card-spot',

            });

            draggable.on('swappable:swapped', () => {
                contaCartas();
                verificaImg();
            })
            draggable.on('swappable:stop', () => {
                contaCartas();
                verificaImg();
            })

            localStorage.clear();

            //Sript que armazena o posicionamento das cartas no Local Storage

            var spots = document.getElementsByClassName('card-spot');

            function getPosition(){

                localStorage.clear();

                for(i=0; i< spots.length; i++){
                    var espaco = spots[i].innerHTML;
                    localStorage.setItem(`item${i}`, espaco);
                }

            }

            //Script que resgata as posições das cartas através do local Storage

            function setPosition() {
                if(window.localStorage.length > 3){

                    for(i=0; i<spots.length; i++){
                        spots[i].innerHTML = localStorage.getItem(`item${i}`);
                    }

                }
            }

            // Script que ativa o reposicionamento das cartas //

            var dragmeIsActive = false;
            var emptySpace = `<img style="height: 42px;" class="drag-me" src="../img/vazio.png">`
            function dragmeToogle(){

                if(dragmeIsActive == false) {

                    for(i = 0; i< spots.length; i++){

                        if(spots[i].hasChildNodes()){
                            let spotChild = spots[i].children;
                                if(!spotChild[0].classList.contains("dont-move")){
                                    spotChild[0].classList.add('drag-me');
                                    spotChild[0].setAttribute('draggable', 'true');
                                    spotChild[0].setAttribute('ondragstart', 'drag(event)');
                                }
                        }else{
                            spots[i].innerHTML = emptySpace;
                        }
                    }

                   dragmeIsActive = !dragmeIsActive;
                   document.getElementById("itemPositionButton").innerText = 'Salvar';

                } else if (dragmeIsActive == true){

                    for(i = 0; i< spots.length; i++){

                        if(spots[i].hasChildNodes()){
                            let spotChild = spots[i].children;
                            if(spots[i].innerHTML == emptySpace){
                                spots[i].innerHTML = '';

                            } else {
                                spotChild[0].classList.remove('drag-me');
                                spotChild[0].setAttribute('draggable', 'false');

                            }
                        }

                    }

                    dragmeIsActive = !dragmeIsActive;
                    document.getElementById("itemPositionButton").innerText = "Posicionar";
                    getPosition();
                }

            }

            // Script que permite o reposicionamento das cartas //

            var dropSpot = document.getElementsByClassName('card-spot');
            var oldFather;

            for(i=0; i < dropSpot.length; i++){
                dropSpot[i].setAttribute('ondrop', 'drop(event)');
                dropSpot[i].setAttribute('ondragover', 'allowdrop(event)');
            }

            function allowdrop(event){
                event.preventDefault();
            }

            function drag(event){
                oldFather = event.target.parentNode;
                event.dataTransfer.setData('text', event.target.id);
            }

            function drop(event){
                event.preventDefault();
                var data = event.dataTransfer.getData('text');
                if(event.target.hasChildNodes()){
                    var child = event.target.childNodes;
                    oldFather.appendChild(child[0]);
                    event.target.appendChild(document.getElementById(data));
                } else if(event.target.className == 'drag-me'){
                    let targetParent = event.target.parentNode;
                    targetParent.appendChild(document.getElementById(data));
                    oldFather.appendChild(event.target);
                } else {

                    event.target.appendChild(document.getElementById(data));
                }
                contaCartas();
                verificaImg();

            }

            // script que conta a quantidade de cartas posicionadas no album

            function contaCartas(){
                var qntCartas = 0;
                for (i = 0; i < 16; i++){

                    if(spots[i].hasChildNodes()){
                        qntCartas++;
                    }
                }
                document.getElementById('contador-cartas').innerText = `${qntCartas}/16 figurinhas`
            }
            contaCartas();


            // Script que verifica as combinações

            // 1 - soma as linhas do jogo

            var data_types = [];
            var numComb = 0;

            function verificaImg(){
                data_types = [];

                for(i = 0; i< spots.length; i++){

                    if(spots[i].hasChildNodes()){
                        let spotChild = spots[i].children;
                        let value = parseInt(spotChild[0].getAttribute('data-cardtype'));
                        data_types.push(value);

                    } else {
                        let value = 0;
                        data_types.push(value);
                    }
                }
                somaLinhas();
            }

            function somaLinhas(){

                let somaCol1 = [data_types[0], data_types[4], data_types[8], data_types[12]].reduce(function(anterior, atual) {
                    return anterior + atual;
                });
                let somaCol2 = [data_types[1], data_types[5], data_types[9], data_types[13]].reduce(function(anterior, atual) {
                    return anterior + atual;
                });
                let somaCol3 = [data_types[2], data_types[6], data_types[10], data_types[14]].reduce(function(anterior, atual) {
                    return anterior + atual;
                });
                let somaCol4 = [data_types[3], data_types[7], data_types[11], data_types[15]].reduce(function(anterior, atual) {
                    return anterior + atual;
                });

                let somaLin1 = data_types.slice(0,4).reduce(function(anterior, atual) {
                    return anterior + atual;
                });
                let somaLin2 = data_types.slice(4,8).reduce(function(anterior, atual) {
                    return anterior + atual;
                });
                let somaLin3 = data_types.slice(8,12).reduce(function(anterior, atual) {
                    return anterior + atual;
                });
                let somaLin4 = data_types.slice(12, 16).reduce(function(anterior, atual) {
                    return anterior + atual;
                });

                // 2 - Confirma as combinações

                numComb = 0;

                if(somaCol1 === 33){
                    numComb++;
                }
                if(somaCol2 === 33){
                    numComb++;
                }
                if(somaCol3 === 33){
                    numComb++;
                }
                if(somaCol4 === 33){
                    numComb++;
                }

                if(somaLin1 === 33){
                    numComb++
                }
                if(somaLin2 === 33){
                    numComb++
                }
                if(somaLin3 === 33){
                    numComb++
                }
                if(somaLin4 === 33){
                    numComb++
                }

                document.getElementById('contador-comb').innerText = `${numComb}/8 Combinações`;
            }

            verificaImg();

        </script>
    </body>
</html>
